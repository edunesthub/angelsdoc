{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\n// prettier-ignore\nvar MARKERS = [0xffc0, 0xffc1, 0xffc2, 0xffc3, 0xffc5, 0xffc6, 0xffc7, 0xffc8, 0xffc9, 0xffca, 0xffcb, 0xffcc, 0xffcd, 0xffce, 0xffcf];\nvar ColorSpace;\n(function (ColorSpace) {\n  ColorSpace[\"DeviceGray\"] = \"DeviceGray\";\n  ColorSpace[\"DeviceRGB\"] = \"DeviceRGB\";\n  ColorSpace[\"DeviceCMYK\"] = \"DeviceCMYK\";\n})(ColorSpace || (ColorSpace = {}));\nvar ChannelToColorSpace = {\n  1: ColorSpace.DeviceGray,\n  3: ColorSpace.DeviceRGB,\n  4: ColorSpace.DeviceCMYK\n};\n/**\n * A note of thanks to the developers of https://github.com/foliojs/pdfkit, as\n * this class borrows from:\n *   https://github.com/foliojs/pdfkit/blob/a6af76467ce06bd6a2af4aa7271ccac9ff152a7d/lib/image/jpeg.js\n */\nvar JpegEmbedder = /** @class */function () {\n  function JpegEmbedder(imageData, bitsPerComponent, width, height, colorSpace) {\n    this.imageData = imageData;\n    this.bitsPerComponent = bitsPerComponent;\n    this.width = width;\n    this.height = height;\n    this.colorSpace = colorSpace;\n  }\n  JpegEmbedder.for = function (imageData) {\n    return __awaiter(this, void 0, void 0, function () {\n      var dataView, soi, pos, marker, bitsPerComponent, height, width, channelByte, channelName, colorSpace;\n      return __generator(this, function (_a) {\n        dataView = new DataView(imageData.buffer);\n        soi = dataView.getUint16(0);\n        if (soi !== 0xffd8) throw new Error('SOI not found in JPEG');\n        pos = 2;\n        while (pos < dataView.byteLength) {\n          marker = dataView.getUint16(pos);\n          pos += 2;\n          if (MARKERS.includes(marker)) break;\n          pos += dataView.getUint16(pos);\n        }\n        if (!MARKERS.includes(marker)) throw new Error('Invalid JPEG');\n        pos += 2;\n        bitsPerComponent = dataView.getUint8(pos++);\n        height = dataView.getUint16(pos);\n        pos += 2;\n        width = dataView.getUint16(pos);\n        pos += 2;\n        channelByte = dataView.getUint8(pos++);\n        channelName = ChannelToColorSpace[channelByte];\n        if (!channelName) throw new Error('Unknown JPEG channel.');\n        colorSpace = channelName;\n        return [2 /*return*/, new JpegEmbedder(imageData, bitsPerComponent, width, height, colorSpace)];\n      });\n    });\n  };\n  JpegEmbedder.prototype.embedIntoContext = function (context, ref) {\n    return __awaiter(this, void 0, void 0, function () {\n      var xObject;\n      return __generator(this, function (_a) {\n        xObject = context.stream(this.imageData, {\n          Type: 'XObject',\n          Subtype: 'Image',\n          BitsPerComponent: this.bitsPerComponent,\n          Width: this.width,\n          Height: this.height,\n          ColorSpace: this.colorSpace,\n          Filter: 'DCTDecode',\n          // CMYK JPEG streams in PDF are typically stored complemented,\n          // with 1 as 'off' and 0 as 'on' (PDF 32000-1:2008, 8.6.4.4).\n          //\n          // Standalone CMYK JPEG (usually exported by Photoshop) are\n          // stored inverse, with 0 as 'off' and 1 as 'on', like RGB.\n          //\n          // Applying a swap here as a hedge that most bytes passing\n          // through this method will benefit from it.\n          Decode: this.colorSpace === ColorSpace.DeviceCMYK ? [1, 0, 1, 0, 1, 0, 1, 0] : undefined\n        });\n        if (ref) {\n          context.assign(ref, xObject);\n          return [2 /*return*/, ref];\n        } else {\n          return [2 /*return*/, context.register(xObject)];\n        }\n        return [2 /*return*/];\n      });\n    });\n  };\n  return JpegEmbedder;\n}();\nexport default JpegEmbedder;\n//# sourceMappingURL=JpegEmbedder.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}